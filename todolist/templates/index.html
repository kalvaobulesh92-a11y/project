<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>My To-Do List</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

<style>
body {
    background:#eef2f7;
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    padding:15px;
}
.card {
    border-radius:14px;
    border:none;
    background:white;
    width:100%;
    max-width:420px;
    box-shadow:0 10px 30px rgba(0,0,0,0.1);
    display:flex;
    flex-direction:column;
}
.card-header {
    background: linear-gradient(135deg,#ff6b6b,#f06595,#cc5de8);
    border-radius:14px 14px 0 0;
    text-align:center;
    color:white;
}
.list-group {
    flex-grow:1;
    overflow-y:auto;
}
.list-group-item {
    border-left:5px solid #ff6b6b;
    border-radius:10px;
    margin-bottom:8px;
    box-shadow:0 2px 4px rgba(0,0,0,0.06);
    position:relative;
    overflow:hidden;
}

/* Buttons */
.btn-add    { background: linear-gradient(90deg,#20c997,#12b886); border:none; color:white; }
.btn-edit   { background: linear-gradient(90deg,#4c6ef5,#1c7ed6); border:none; color:white; }
.btn-delete { background: linear-gradient(90deg,#fa5252,#e03131); border:none; color:white; }
.btn-add:hover, .btn-edit:hover, .btn-delete:hover { opacity:0.85; }

.btn-sm {
    width:36px; height:36px; padding:0; border-radius:8px;
    display:inline-flex; justify-content:center; align-items:center;
    font-size:16px;
}
.btn-sm i { color:white; }

/* Edit form styling */
.edit-form {
    display:flex; gap:8px; align-items:center;
    padding:12px;
    background:rgba(255,255,255,0.95);
}
.edit-form .form-control { flex:1; border-radius:8px; }

/* Checkbox hack styles */
.visually-hidden { position:absolute; opacity:0; pointer-events:none; width:0; height:0; }
.edit-mode { display:none; }
.edit-toggle:checked ~ .edit-mode { display:flex !important; }
.edit-toggle:checked ~ .display-mode { display:none !important; }
</style>
</head>
<body>

<div class="card">
  <div class="card-header py-3">
    <h4 class="mb-0"><i class="bi bi-check2-circle"></i> My To-Do List</h4>
  </div>

  <div class="card-body p-3 d-flex flex-column gap-3">

    <!-- Add New Task -->
    <form action="{% url 'addtask' %}" method="post" class="input-group">
      {% csrf_token %}
      <input type="text" name="task" class="form-control" placeholder="Add new task..." required autocomplete="off">
      <button type="submit" class="btn btn-add"><i class="bi bi-plus-lg"></i></button>
    </form>

    <!-- Task List -->
    <ul class="list-group">

      {% for i in todolist %}
      <li class="list-group-item">

        <!-- Hidden checkbox controls edit mode -->
        <input type="checkbox" class="visually-hidden edit-toggle" id="edit-{{ i.id }}">

        <!-- DISPLAY MODE -->
        <div class="display-mode d-flex justify-content-between align-items-center p-3">
          <span class="fw-medium">{{ i.task }}</span>

          <div class="d-flex gap-1">
            <!-- Edit Trigger (label acts as button) -->
            <label for="edit-{{ i.id }}" class="btn btn-edit btn-sm mb-0" role="button" tabindex="0">
              <i class="bi bi-pencil"></i>
            </label>

            <!-- Delete Form (proper POST) -->
            <form action="{% url 'deletetask' i.id %}" method="post" class="d-inline">
              {% csrf_token %}
              <button type="submit" class="btn btn-delete btn-sm"
                      onclick="return confirm('Delete this task?')">
                <i class="bi bi-trash"></i>
              </button>
            </form>
          </div>
        </div>

        <!-- EDIT MODE -->
        <div class="edit-mode">
          <form action="{% url 'edittask' i.id %}" method="post" class="edit-form">
            {% csrf_token %}
            <input type="text" name="task" value="{{ i.task }}" class="form-control" required>
            <div class="d-flex gap-1">
              <button type="submit" class="btn btn-success btn-sm">
                <i class="bi bi-check-lg"></i>
              </button>
              <!-- Cancel = uncheck the hidden checkbox -->
              <label for="edit-{{ i.id }}" class="btn btn-secondary btn-sm">
                <i class="bi bi-x-lg"></i>
              </label>
            </div>
          </form>
        </div>

      </li>
      {% empty %}
      <li class="list-group-item text-center text-muted py-4">
        No tasks yet. Add one above!
      </li>
      {% endfor %}

    </ul>
  </div>
</div>

</body>
</html>